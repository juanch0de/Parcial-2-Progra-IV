import unittest
from crud.producto_crud import crear_producto, actualizar_producto, eliminar_producto, mostrar_productos
from modelo.Fertilizante import Fertilizante
from modelo.Plaguicida import Plaguicida
from modelo.Antibiotico import Antibiotico
from modelo.ProductoControl import ProductoControl
from datetime import date

class TestProductoCRUD(unittest.TestCase):
    def setUp(self):
        from crud.producto_crud import productos
        global productos
        productos.clear()

    def test_crear_fertilizante(self):
        f = crear_producto(
            "fertilizante",
            ICA="F001",
            nombre="Ferti1",
            frecuencia_aplicacion_dias=10,
            precio=50,
            fecha_ultima_aplicacion=date(2025, 11, 4)
        )
        self.assertIsInstance(f, Fertilizante)
        self.assertEqual(f.nombre, "Ferti1")
        self.assertEqual(f.ICA, "F001")

    def test_crear_plaguicida(self):
        p = crear_producto(
            "plaguicida",
            ICA="P001",
            nombre="Plag1",
            frecuencia_aplicacion_dias=15,
            precio=75,
            periodo_carencia_dias=5
        )
        self.assertIsInstance(p, Plaguicida)
        self.assertEqual(p.nombre, "Plag1")
        self.assertEqual(p.ICA, "P001")
        self.assertEqual(p.periodo_carencia_dias, 5)

    def test_crear_antibiotico(self):
        a = crear_producto(
            "antibiotico",
            nombre="Anti1",
            dosisKG=2,
            animal="Vaca",
            precio=100
        )
        self.assertIsInstance(a, Antibiotico)
        self.assertEqual(a.nombre, "Anti1")
        self.assertEqual(a.dosisKG, 2)
        self.assertEqual(a.animal, "Vaca")

    def test_actualizar_producto(self):
        f = crear_producto(
            "fertilizante",
            ICA="F002",
            nombre="Ferti2",
            frecuencia_aplicacion_dias=12,
            precio=60,
            fecha_ultima_aplicacion=date(2025, 11, 4)
        )
        updated = actualizar_producto("F002", nombre="Ferti2Actualizado", precio=65)
        self.assertTrue(updated)
        self.assertEqual(f.nombre, "Ferti2Actualizado")
        self.assertEqual(f.precio, 65)

    def test_eliminar_producto(self):
        f = crear_producto(
            "fertilizante",
            ICA="F003",
            nombre="Ferti3",
            frecuencia_aplicacion_dias=12,
            precio=60,
            fecha_ultima_aplicacion=date(2025, 11, 4)
        )
        deleted = eliminar_producto("F003")
        self.assertTrue(deleted)
        self.assertEqual(len(mostrar_producto()), 0)

    def test_mostrar_productos(self):
        crear_producto(
            "fertilizante",
            ICA="F004",
            nombre="Ferti4",
            frecuencia_aplicacion_dias=12,
            precio=60,
            fecha_ultima_aplicacion=date(2025, 11, 4)
        )
        crear_producto(
            "antibiotico",
            nombre="Anti2",
            dosisKG=3,
            animal="Oveja",
            precio=90
        )
        productos_list = mostrar_productos()
        self.assertEqual(len(productos_list), 2)
        tipos = [type(p).__name__ for p in productos_list]
        self.assertIn("Fertilizante", tipos)
        self.assertIn("Antibiotico", tipos)

if __name__ == "__main__":
    unittest.main()

